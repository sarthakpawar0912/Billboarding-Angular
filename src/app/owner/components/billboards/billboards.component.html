<div class="billboards-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <span class="header-icon">üéØ</span>
        My Billboards
      </h1>
      <p>Manage and track all your billboard listings</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-refresh" (click)="loadBillboards()">
        <span>üîÑ</span> Refresh
      </button>
      <button class="btn btn-primary" (click)="openCreateModal()">
        <span>‚ûï</span> Add New Billboard
      </button>
    </div>
  </div>

  <!-- Success/Error Toast Notifications -->
  @if (successMessage()) {
    <div class="toast-success">
      <span class="toast-icon">‚úì</span>
      <span>{{ successMessage() }}</span>
    </div>
  }

  @if (errorMessage()) {
    <div class="toast-error">
      <span class="toast-icon">‚úï</span>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue">üìã</div>
      <div class="stat-content">
        <span class="stat-value">{{ stats().total }}</span>
        <span class="stat-label">Total Billboards</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green">‚úÖ</div>
      <div class="stat-content">
        <span class="stat-value">{{ stats().available }}</span>
        <span class="stat-label">Available</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orange">‚è∏Ô∏è</div>
      <div class="stat-content">
        <span class="stat-value">{{ stats().unavailable }}</span>
        <span class="stat-label">Unavailable</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">üí∞</div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(stats().totalRevenue) }}</span>
        <span class="stat-label">Total Daily Rate</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <span class="search-icon">üîç</span>
      <input type="text"
             placeholder="Search billboards by title or location..."
             [value]="searchTerm()"
             (input)="onSearch($event)">
    </div>
    <div class="filter-group">
      <select [value]="availabilityFilter()" (change)="onFilterChange($event)">
        <option value="all">All Status</option>
        <option value="available">Available</option>
        <option value="unavailable">Unavailable</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading your billboards...</p>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-container">
      <div class="error-content">
        <span class="error-icon">‚ö†Ô∏è</span>
        <h3>Something went wrong</h3>
        <p>{{ error() }}</p>
        <button class="btn btn-primary" (click)="loadBillboards()">
          Try Again
        </button>
      </div>
    </div>
  }

  <!-- Billboards Grid -->
  @if (!loading() && !error()) {
    @if (filteredBillboards().length > 0) {
      <div class="billboards-grid">
        @for (billboard of filteredBillboards(); track billboard.id; let i = $index) {
          <div class="billboard-card" [style.animation-delay]="(i * 0.05) + 's'">
            <!-- Premium Image Carousel -->
            <div class="card-image-wrapper"
                 (mouseenter)="billboard.imagePaths?.length ? startCarousel(billboard.id, billboard.imagePaths!.length) : null"
                 (mouseleave)="stopCarousel(billboard.id)"
                 (click)="billboard.imagePaths?.length ? openImageGallery(billboard) : null">

              @if (billboard.imagePaths && billboard.imagePaths.length > 0) {
                <!-- Carousel Container -->
                <div class="carousel-container">
                  @for (imagePath of billboard.imagePaths; track $index; let imgIndex = $index) {
                    <div class="carousel-slide"
                         [class.active]="getCarouselIndex(billboard.id) === imgIndex"
                         [class.prev]="getCarouselIndex(billboard.id) === (imgIndex + 1) % billboard.imagePaths!.length"
                         [class.next]="getCarouselIndex(billboard.id) === (imgIndex === 0 ? billboard.imagePaths!.length - 1 : imgIndex - 1)">
                      <img [src]="getImageUrl(imagePath)" alt="Billboard Image {{ imgIndex + 1 }}">
                    </div>
                  }
                </div>

                <!-- Carousel Navigation Arrows -->
                @if (billboard.imagePaths.length > 1) {
                  <button class="carousel-arrow prev" (click)="prevCarouselImage(billboard.id, billboard.imagePaths.length, $event)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M15 18l-6-6 6-6"/>
                    </svg>
                  </button>
                  <button class="carousel-arrow next" (click)="nextCarouselImage(billboard.id, billboard.imagePaths.length, $event)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 18l6-6-6-6"/>
                    </svg>
                  </button>

                  <!-- Carousel Dots -->
                  <div class="carousel-dots">
                    @for (imagePath of billboard.imagePaths; track $index; let dotIndex = $index) {
                      <button class="carousel-dot"
                              [class.active]="getCarouselIndex(billboard.id) === dotIndex"
                              (click)="setCarouselIndex(billboard.id, dotIndex); $event.stopPropagation()">
                      </button>
                    }
                  </div>
                }

                <!-- Image Counter Badge -->
                <div class="image-counter">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21,15 16,10 5,21"/>
                  </svg>
                  <span>{{ getCarouselIndex(billboard.id) + 1 }}/{{ billboard.imagePaths.length }}</span>
                </div>

              } @else if (billboard.imageUrl) {
                <div class="carousel-container">
                  <div class="carousel-slide active">
                    <img [src]="billboard.imageUrl" alt="Billboard">
                  </div>
                </div>
              } @else {
                <div class="image-placeholder">
                  <div class="placeholder-content">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                      <circle cx="8.5" cy="8.5" r="1.5"/>
                      <polyline points="21,15 16,10 5,21"/>
                    </svg>
                    <span>No Images</span>
                  </div>
                </div>
              }

              <!-- Status Badge -->
              <div class="status-badge"
                   [class.available]="billboard.available && !billboard.adminBlocked"
                   [class.unavailable]="!billboard.available && !billboard.adminBlocked"
                   [class.admin-blocked]="billboard.adminBlocked">
                <span class="status-dot"></span>
                @if (billboard.adminBlocked) {
                  Admin Blocked
                } @else {
                  {{ billboard.available ? 'Available' : 'Unavailable' }}
                }
              </div>

              <!-- Type Badge Overlay -->
              <div class="type-badge-overlay">
                <span class="type-icon">{{ getBillboardTypeInfo(billboard.type).icon }}</span>
                <span class="type-text">{{ getBillboardTypeInfo(billboard.type).label }}</span>
              </div>
            </div>

            <!-- Card Content -->
            <div class="card-body">
              <!-- Title & Location -->
              <div class="card-header-section">
                <h3 class="card-title">{{ billboard.title }}</h3>
                <div class="location-row">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                  <span>{{ billboard.location }}</span>
                </div>
              </div>

              <!-- Info Grid -->
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-icon size-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="15,3 21,3 21,9"/>
                      <polyline points="9,21 3,21 3,15"/>
                      <line x1="21" y1="3" x2="14" y2="10"/>
                      <line x1="3" y1="21" x2="10" y2="14"/>
                    </svg>
                  </div>
                  <div class="info-text">
                    <span class="info-label">Size</span>
                    <span class="info-value">{{ billboard.size }}</span>
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-icon coords-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="2" y1="12" x2="22" y2="12"/>
                      <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                  </div>
                  <div class="info-text">
                    <span class="info-label">Coordinates</span>
                    <span class="info-value coords">{{ billboard.latitude?.toFixed(2) }}, {{ billboard.longitude?.toFixed(2) }}</span>
                  </div>
                </div>
              </div>

              <!-- Date -->
              <div class="date-row">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
                <span>Added {{ formatDate(billboard.createdAt) }}</span>
              </div>

              <!-- Price & Actions -->
              <div class="card-footer">
                <div class="price-tag">
                  <span class="price-amount">{{ formatCurrency(billboard.pricePerDay) }}</span>
                  <span class="price-period">per day</span>
                </div>
                <div class="action-buttons">
                  <button class="action-btn calendar-btn" title="View Calendar" (click)="openCalendarModal(billboard)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                      <line x1="16" y1="2" x2="16" y2="6"/>
                      <line x1="8" y1="2" x2="8" y2="6"/>
                      <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                  </button>
                  <button class="action-btn map-btn" title="View on Map" (click)="openMapDetailModal(billboard)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                      <circle cx="12" cy="10" r="3"/>
                    </svg>
                  </button>
                  <button class="action-btn upload-btn" title="Upload Images" (click)="openImageUploadModal(billboard)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="17,8 12,3 7,8"/>
                      <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                  </button>
                  <button class="action-btn edit-btn" title="Edit" (click)="openEditModal(billboard)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  </button>
                  @if (billboard.adminBlocked) {
                    <button class="action-btn toggle-btn admin-blocked-btn" disabled
                            title="Blocked by Admin - Contact support">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                      </svg>
                    </button>
                  } @else {
                    <button class="action-btn toggle-btn"
                            [class.available]="billboard.available"
                            [title]="billboard.available ? 'Mark Unavailable' : 'Mark Available'"
                            (click)="toggleAvailability(billboard)">
                      @if (billboard.available) {
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <rect x="6" y="4" width="4" height="16"/>
                          <rect x="14" y="4" width="4" height="16"/>
                        </svg>
                      } @else {
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polygon points="5,3 19,12 5,21 5,3"/>
                        </svg>
                      }
                    </button>
                  }
                  <button class="action-btn delete-btn" title="Delete" (click)="openDeleteModal(billboard)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"/>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      <line x1="10" y1="11" x2="10" y2="17"/>
                      <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="empty-state">
        <div class="empty-icon-wrapper">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <line x1="3" y1="9" x2="21" y2="9"/>
            <line x1="9" y1="21" x2="9" y2="9"/>
          </svg>
        </div>
        <h3>No billboards found</h3>
        <p>
          @if (searchTerm() || availabilityFilter() !== 'all') {
            Try adjusting your filters or search term
          } @else {
            Start by adding your first billboard
          }
        </p>
        <button class="btn btn-primary" (click)="openCreateModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Add Billboard
        </button>
      </div>
    }
  }

  <!-- Create Billboard Modal -->
  @if (showCreateModal()) {
    <div class="modal-overlay" (click)="closeModals()">
      <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-icon create-icon">
            <span>üéØ</span>
          </div>
          <h2>Add New Billboard</h2>
          <button class="modal-close" (click)="closeModals()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="title">Billboard Title <span class="required">*</span></label>
            <input type="text"
                   id="title"
                   class="form-control"
                   placeholder="e.g., Premium Billboard Near Highway"
                   [(ngModel)]="formData.title">
          </div>
          <div class="form-group">
            <label for="location">Location <span class="required">*</span></label>
            <input type="text"
                   id="location"
                   class="form-control"
                   placeholder="e.g., MG Road, Pune"
                   [(ngModel)]="formData.location">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="latitude">Latitude <span class="required">*</span></label>
              <input type="number"
                     id="latitude"
                     class="form-control"
                     placeholder="e.g., 18.5204"
                     step="0.0001"
                     [(ngModel)]="formData.latitude">
            </div>
            <div class="form-group">
              <label for="longitude">Longitude <span class="required">*</span></label>
              <input type="number"
                     id="longitude"
                     class="form-control"
                     placeholder="e.g., 73.8567"
                     step="0.0001"
                     [(ngModel)]="formData.longitude">
            </div>
          </div>
          <div class="form-group">
            <label for="billboardType">Billboard Type <span class="required">*</span></label>
            <div class="type-selector">
              @for (type of billboardTypes; track type.value) {
                <div class="type-option"
                     [class.selected]="formData.type === type.value"
                     (click)="formData.type = type.value">
                  <span class="type-icon">{{ type.icon }}</span>
                  <span class="type-label">{{ type.label }}</span>
                  <span class="type-desc">{{ type.description }}</span>
                </div>
              }
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="size">Size <span class="required">*</span></label>
              <input type="text"
                     id="size"
                     class="form-control"
                     placeholder="e.g., 40x20 ft"
                     [(ngModel)]="formData.size">
            </div>
            <div class="form-group">
              <label for="price">Price Per Day (‚Çπ) <span class="required">*</span></label>
              <input type="number"
                     id="price"
                     class="form-control"
                     placeholder="e.g., 1500"
                     [(ngModel)]="formData.pricePerDay">
            </div>
          </div>
          <div class="form-group">
            <label for="imageUrl">Image URL (Optional)</label>
            <input type="text"
                   id="imageUrl"
                   class="form-control"
                   placeholder="https://example.com/billboard-image.jpg"
                   [(ngModel)]="formData.imageUrl">
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="formData.available">
              <span class="checkbox-custom"></span>
              Available for booking
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeModals()" [disabled]="processing()">
            Cancel
          </button>
          <button class="btn btn-primary" (click)="createBillboard()" [disabled]="processing()">
            @if (processing()) {
              <span class="btn-spinner"></span>
              Creating...
            } @else {
              <span>‚ûï</span> Create Billboard
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Edit Billboard Modal -->
  @if (showEditModal()) {
    <div class="modal-overlay" (click)="closeModals()">
      <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-icon edit-icon">
            <span>‚úèÔ∏è</span>
          </div>
          <h2>Edit Billboard</h2>
          <button class="modal-close" (click)="closeModals()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="edit-title">Billboard Title <span class="required">*</span></label>
            <input type="text"
                   id="edit-title"
                   class="form-control"
                   [(ngModel)]="formData.title">
          </div>
          <div class="form-group">
            <label for="edit-location">Location <span class="required">*</span></label>
            <input type="text"
                   id="edit-location"
                   class="form-control"
                   [(ngModel)]="formData.location">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-latitude">Latitude <span class="required">*</span></label>
              <input type="number"
                     id="edit-latitude"
                     class="form-control"
                     step="0.0001"
                     [(ngModel)]="formData.latitude">
            </div>
            <div class="form-group">
              <label for="edit-longitude">Longitude <span class="required">*</span></label>
              <input type="number"
                     id="edit-longitude"
                     class="form-control"
                     step="0.0001"
                     [(ngModel)]="formData.longitude">
            </div>
          </div>
          <div class="form-group">
            <label for="edit-billboardType">Billboard Type <span class="required">*</span></label>
            <div class="type-selector">
              @for (type of billboardTypes; track type.value) {
                <div class="type-option"
                     [class.selected]="formData.type === type.value"
                     (click)="formData.type = type.value">
                  <span class="type-icon">{{ type.icon }}</span>
                  <span class="type-label">{{ type.label }}</span>
                  <span class="type-desc">{{ type.description }}</span>
                </div>
              }
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-size">Size <span class="required">*</span></label>
              <input type="text"
                     id="edit-size"
                     class="form-control"
                     [(ngModel)]="formData.size">
            </div>
            <div class="form-group">
              <label for="edit-price">Price Per Day (‚Çπ) <span class="required">*</span></label>
              <input type="number"
                     id="edit-price"
                     class="form-control"
                     [(ngModel)]="formData.pricePerDay">
            </div>
          </div>
          <div class="form-group">
            <label for="edit-imageUrl">Image URL</label>
            <input type="text"
                   id="edit-imageUrl"
                   class="form-control"
                   [(ngModel)]="formData.imageUrl">
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="formData.available">
              <span class="checkbox-custom"></span>
              Available for booking
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeModals()" [disabled]="processing()">
            Cancel
          </button>
          <button class="btn btn-primary" (click)="updateBillboard()" [disabled]="processing()">
            @if (processing()) {
              <span class="btn-spinner"></span>
              Updating...
            } @else {
              <span>üíæ</span> Save Changes
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Delete Confirmation Modal -->
  @if (showDeleteModal()) {
    <div class="modal-overlay" (click)="closeModals()">
      <div class="modal-container delete-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-icon danger-icon">
            <span>üóëÔ∏è</span>
          </div>
          <h2>Delete Billboard</h2>
          <button class="modal-close" (click)="closeModals()">√ó</button>
        </div>
        <div class="modal-body">
          <p class="delete-warning">Are you sure you want to delete this billboard?</p>
          <div class="delete-preview">
            <strong>{{ selectedBillboard()?.title }}</strong>
            <span>üìç {{ selectedBillboard()?.location }}</span>
            <span>üí∞ {{ formatCurrency(selectedBillboard()?.pricePerDay || 0) }}/day</span>
          </div>
          <div class="delete-notice">
            <span class="notice-icon">‚ö†Ô∏è</span>
            <p>This action cannot be undone. All data associated with this billboard will be permanently deleted.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeModals()" [disabled]="processing()">
            Cancel
          </button>
          <button class="btn btn-danger" (click)="deleteBillboard()" [disabled]="processing()">
            @if (processing()) {
              <span class="btn-spinner"></span>
              Deleting...
            } @else {
              <span>üóëÔ∏è</span> Delete Billboard
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Bookings Warning Modal -->
  @if (showBookingsWarningModal()) {
    <div class="modal-overlay" (click)="closeModals()">
      <div class="modal-container delete-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-icon warning-icon">
            <span>‚ö†Ô∏è</span>
          </div>
          <h2>Billboard Has Bookings</h2>
          <button class="modal-close" (click)="closeModals()">√ó</button>
        </div>
        <div class="modal-body">
          <p class="delete-warning">This billboard has active bookings!</p>
          <div class="delete-preview">
            <strong>{{ selectedBillboard()?.title }}</strong>
            <span>üìç {{ selectedBillboard()?.location }}</span>
            <span>üìÖ {{ bookingsCount() }} booking(s) associated</span>
          </div>
          <div class="delete-notice" style="background: #fef3c7; border-color: #f59e0b;">
            <span class="notice-icon">üìã</span>
            <p>Deleting this billboard will also cancel all associated bookings. Advertisers will be notified about the cancellation.</p>
          </div>
          <div class="delete-notice">
            <span class="notice-icon">‚ö†Ô∏è</span>
            <p>This action cannot be undone. Are you sure you want to proceed?</p>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeModals()" [disabled]="processing()">
            Cancel
          </button>
          <button class="btn btn-danger" (click)="forceDeleteBillboard()" [disabled]="processing()">
            @if (processing()) {
              <span class="btn-spinner"></span>
              Deleting...
            } @else {
              <span>üóëÔ∏è</span> Delete Anyway
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Image Upload Modal -->
  @if (showImageUploadModal()) {
    <div class="modal-overlay" (click)="closeModals()">
      <div class="modal-container image-upload-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-icon upload-icon">
            <span>üì∑</span>
          </div>
          <h2>Upload Billboard Images</h2>
          <button class="modal-close" (click)="closeModals()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="upload-info">
            <div class="info-card">
              <span class="info-icon">‚ÑπÔ∏è</span>
              <div class="info-text">
                <strong>Image Requirements</strong>
                <p>Minimum 3 images required. You can upload as many as you want.</p>
              </div>
            </div>
          </div>

          <div class="upload-zone" (click)="fileInput.click()">
            <input type="file"
                   #fileInput
                   multiple
                   accept="image/*"
                   (change)="onImageSelect($event)"
                   style="display: none">
            <div class="upload-content">
              <span class="upload-icon">üì§</span>
              <h3>Click to select images</h3>
              <p>or drag and drop your files here</p>
              <span class="upload-hint">JPG, PNG, GIF up to 10MB each</span>
            </div>
          </div>

          @if (imagePreviewUrls.length > 0) {
            <div class="selected-images-section">
              <div class="section-header">
                <h4>Selected Images ({{ imagePreviewUrls.length }})</h4>
                <button class="btn-clear" (click)="clearImageSelection()">Clear All</button>
              </div>
              <div class="image-preview-grid">
                @for (preview of imagePreviewUrls; track $index; let i = $index) {
                  <div class="preview-item">
                    <img [src]="preview" alt="Preview">
                    <button class="remove-btn" (click)="removeSelectedImage(i)">√ó</button>
                    <span class="preview-number">{{ i + 1 }}</span>
                  </div>
                }
              </div>
            </div>
          }

          @if (imagePreviewUrls.length > 0 && imagePreviewUrls.length < 3) {
            <div class="warning-message">
              <span>‚ö†Ô∏è</span>
              <span>Please select at least {{ 3 - imagePreviewUrls.length }} more image(s)</span>
            </div>
          }
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeModals()" [disabled]="processing()">
            Cancel
          </button>
          <button class="btn btn-primary"
                  (click)="uploadImages()"
                  [disabled]="processing() || imagePreviewUrls.length < 3">
            @if (processing()) {
              <span class="btn-spinner"></span>
              Uploading...
            } @else {
              <span>üì§</span> Upload {{ imagePreviewUrls.length }} Image(s)
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Image Gallery Modal -->
  @if (showImageGalleryModal()) {
    <div class="modal-overlay gallery-overlay" (click)="closeModals()">
      <div class="gallery-container" (click)="$event.stopPropagation()">
        <button class="gallery-close" (click)="closeModals()">√ó</button>

        <div class="gallery-header">
          <h3>{{ selectedBillboard()?.title }}</h3>
          <span class="gallery-counter">{{ currentGalleryIndex() + 1 }} / {{ selectedBillboard()?.imagePaths?.length }}</span>
        </div>

        <div class="gallery-main">
          <button class="gallery-nav prev"
                  (click)="prevGalleryImage()"
                  [disabled]="currentGalleryIndex() === 0">
            ‚Äπ
          </button>

          <div class="gallery-image-wrapper">
            @if (selectedBillboard()?.imagePaths) {
              <img [src]="getImageUrl(selectedBillboard()!.imagePaths![currentGalleryIndex()])"
                   alt="Billboard Image"
                   class="gallery-main-image">
            }
          </div>

          <button class="gallery-nav next"
                  (click)="nextGalleryImage()"
                  [disabled]="currentGalleryIndex() === (selectedBillboard()?.imagePaths?.length || 1) - 1">
            ‚Ä∫
          </button>
        </div>

        <div class="gallery-thumbnails">
          @if (selectedBillboard()?.imagePaths) {
            @for (imagePath of selectedBillboard()!.imagePaths!; track $index; let i = $index) {
              <div class="thumbnail"
                   [class.active]="i === currentGalleryIndex()"
                   (click)="setGalleryIndex(i)">
                <img [src]="getImageUrl(imagePath)" alt="Thumbnail">
              </div>
            }
          }
        </div>
      </div>
    </div>
  }

  <!-- Map Detail Modal -->
  @if (showMapDetailModal()) {
    <div class="modal-overlay" (click)="closeMapDetailModal()">
      <div class="modal-container map-detail-modal" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeMapDetailModal()">√ó</button>

        @if (loadingMapDetail()) {
          <div class="map-detail-loading">
            <div class="spinner"></div>
            <p>Loading billboard details...</p>
          </div>
        } @else if (mapDetailBillboard()) {
          <div class="map-detail-content">
            <!-- Image Gallery -->
            <div class="map-detail-gallery">
              @if (mapDetailBillboard()!.imagePaths && mapDetailBillboard()!.imagePaths.length > 0) {
                <div class="map-detail-carousel">
                  <div class="map-detail-carousel-images" [style.transform]="getMapDetailCarouselTransform()">
                    @for (imagePath of mapDetailBillboard()!.imagePaths; track imagePath) {
                      <img [src]="getImageUrl(imagePath)" alt="Billboard">
                    }
                  </div>
                  @if (mapDetailBillboard()!.imagePaths.length > 1) {
                    <div class="map-detail-carousel-dots">
                      @for (imagePath of mapDetailBillboard()!.imagePaths; track $index; let i = $index) {
                        <button class="map-detail-carousel-dot"
                                [class.active]="mapDetailCarouselIndex() === i"
                                (click)="setMapDetailImageIndex(i)">
                        </button>
                      }
                    </div>
                  }
                </div>
              } @else {
                <div class="map-detail-image-placeholder">
                  <span>üéØ</span>
                </div>
              }
              <span class="map-detail-type-badge">
                {{ getBillboardTypeInfo(mapDetailBillboard()!.type).icon }}
                {{ getBillboardTypeInfo(mapDetailBillboard()!.type).label }}
              </span>
              <span class="map-detail-availability-badge" [class.available]="mapDetailBillboard()!.available">
                {{ mapDetailBillboard()!.available ? '‚úì Available' : '‚úï Unavailable' }}
              </span>
            </div>

            <!-- Billboard Info -->
            <div class="map-detail-info">
              <div class="map-detail-header">
                <h2>{{ mapDetailBillboard()!.title }}</h2>
                <div class="map-detail-price">
                  {{ formatCurrency(mapDetailBillboard()!.pricePerDay) }}
                  <span class="period">/day</span>
                </div>
              </div>

              <div class="map-detail-meta">
                <div class="meta-item">
                  <span class="meta-icon">üìç</span>
                  <span>{{ mapDetailBillboard()!.location }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-icon">üìê</span>
                  <span>{{ mapDetailBillboard()!.size }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-icon">üìÖ</span>
                  <span>Listed {{ mapDetailBillboard()!.createdAt | date:'mediumDate' }}</span>
                </div>
              </div>

              <!-- Map Section -->
              <div class="map-detail-map-section">
                <h3>üìç Location on Map</h3>
                <div class="map-detail-map-container" #detailMapContainer></div>
                <div class="map-coordinates">
                  <span>Lat: {{ mapDetailBillboard()!.latitude }}</span>
                  <span>Lng: {{ mapDetailBillboard()!.longitude }}</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="map-detail-actions">
              <button class="btn btn-outline" (click)="closeMapDetailModal()">Close</button>
              <button class="btn btn-primary" (click)="editFromMapDetail()">
                ‚úèÔ∏è Edit Billboard
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Calendar Modal -->
  @if (showCalendarModal() && calendarBillboard()) {
    <div class="modal-overlay" (click)="closeCalendarModal()">
      <div class="modal-container calendar-modal" (click)="$event.stopPropagation()">
        <div class="modal-header calendar-modal-header">
          <div class="modal-icon calendar-icon">
            <span>üìÖ</span>
          </div>
          <div class="calendar-modal-title">
            <h2>Billboard Calendar</h2>
            <p>{{ calendarBillboard()!.title }} - {{ calendarBillboard()!.location }}</p>
          </div>
          <button class="modal-close" (click)="closeCalendarModal()">√ó</button>
        </div>

        <div class="modal-body calendar-modal-body">
          <app-owner-calendar
            [billboardId]="calendarBillboard()!.id"
            (monthChanged)="onCalendarMonthChanged($event)">
          </app-owner-calendar>
        </div>

        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeCalendarModal()">Close</button>
        </div>
      </div>
    </div>
  }
</div>
