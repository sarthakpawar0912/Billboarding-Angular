<div class="campaigns-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="animate-fade-in-up">
        <span class="header-icon">ğŸ“¢</span>
        My Campaigns
      </h1>
      <p class="animate-fade-in-up delay-1">Manage your advertising campaigns and track performance</p>
    </div>
    <div class="header-actions animate-fade-in-up delay-2">
      <button class="btn btn-glass" (click)="loadCampaigns()">
        <span class="btn-icon">ğŸ”„</span>
        Refresh
      </button>
      <button class="btn btn-primary-glow" (click)="navigateToCreate()">
        <span class="btn-icon">â•</span>
        New Campaign
      </button>
    </div>
  </div>

  <!-- Success/Error Messages -->
  @if (successMessage()) {
    <div class="alert alert-success animate-bounce-in">
      <span class="alert-icon">âœ…</span>
      <span>{{ successMessage() }}</span>
      <button class="alert-close" (click)="clearMessages()">Ã—</button>
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger animate-bounce-in">
      <span class="alert-icon">âŒ</span>
      <span>{{ error() }}</span>
      <button class="alert-close" (click)="clearMessages()">Ã—</button>
    </div>
  }

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card animate-scale-in delay-1" (click)="setStatusFilter('all')">
      <div class="stat-icon blue">
        <span>ğŸ“Š</span>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ stats().totalCampaigns }}</span>
        <span class="stat-label">Total Campaigns</span>
      </div>
      <div class="stat-glow blue"></div>
    </div>

    <div class="stat-card animate-scale-in delay-2" (click)="setStatusFilter('ACTIVE')">
      <div class="stat-icon green">
        <span>ğŸŸ¢</span>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ stats().activeCampaigns }}</span>
        <span class="stat-label">Active</span>
      </div>
      <div class="stat-glow green"></div>
    </div>

    <div class="stat-card animate-scale-in delay-3">
      <div class="stat-icon purple">
        <span>ğŸ’°</span>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(stats().totalBudget) }}</span>
        <span class="stat-label">Total Budget</span>
      </div>
      <div class="stat-glow purple"></div>
    </div>

    <div class="stat-card animate-scale-in delay-4">
      <div class="stat-icon orange">
        <span>ğŸ’¸</span>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ formatCurrency(stats().totalSpent) }}</span>
        <span class="stat-label">Total Spent</span>
      </div>
      <div class="stat-glow orange"></div>
    </div>
  </div>

  <!-- Filter Tabs -->
  <div class="filter-section animate-fade-in-up delay-3">
    <div class="filter-tabs">
      <button
        class="filter-tab"
        [class.active]="statusFilter() === 'all'"
        (click)="setStatusFilter('all')">
        <span>ğŸ“‹</span> All
        <span class="tab-count">{{ stats().totalCampaigns }}</span>
      </button>
      <button
        class="filter-tab"
        [class.active]="statusFilter() === 'ACTIVE'"
        (click)="setStatusFilter('ACTIVE')">
        <span>ğŸŸ¢</span> Active
        @if (stats().activeCampaigns > 0) {
          <span class="tab-count green">{{ stats().activeCampaigns }}</span>
        }
      </button>
      <button
        class="filter-tab"
        [class.active]="statusFilter() === 'PAUSED'"
        (click)="setStatusFilter('PAUSED')">
        <span>â¸ï¸</span> Paused
      </button>
      <button
        class="filter-tab"
        [class.active]="statusFilter() === 'SCHEDULED'"
        (click)="setStatusFilter('SCHEDULED')">
        <span>ğŸ“…</span> Scheduled
      </button>
      <button
        class="filter-tab"
        [class.active]="statusFilter() === 'COMPLETED'"
        (click)="setStatusFilter('COMPLETED')">
        <span>âœ…</span> Completed
      </button>
    </div>

    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input
        type="text"
        class="search-input"
        placeholder="Search campaigns..."
        [value]="searchTerm()"
        (input)="onSearch($event)">
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading your campaigns...</p>
      </div>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && filteredCampaigns().length === 0) {
    <div class="empty-state animate-fade-in-up">
      @if (statusFilter() === 'all' && stats().totalCampaigns === 0) {
        <div class="empty-icon">ğŸ“¢</div>
        <h3>No Campaigns Yet</h3>
        <p>Create your first campaign to start advertising!</p>
        <button class="btn btn-primary-glow" (click)="navigateToCreate()">
          <span>â•</span> Create Your First Campaign
        </button>
      } @else {
        <div class="empty-icon">ğŸ”</div>
        <h3>No Results Found</h3>
        <p>No campaigns match your current filters.</p>
        <button class="btn btn-outline" (click)="setStatusFilter('all'); searchTerm.set('')">
          Clear Filters
        </button>
      }
    </div>
  }

  <!-- Campaigns Grid -->
  @if (!loading() && filteredCampaigns().length > 0) {
    <div class="campaigns-grid animate-fade-in-up delay-4">
      @for (campaign of filteredCampaigns(); track campaign.id; let i = $index) {
        <div class="campaign-card" [style.animation-delay]="(i * 0.05) + 's'">
          <!-- Status Bar -->
          <div class="campaign-status-bar" [class]="'status-' + campaign.status.toLowerCase()"></div>

          <!-- Card Header -->
          <div class="campaign-card-header">
            <div class="campaign-info">
              <h3 class="campaign-title">{{ campaign.name }}</h3>
              <p class="campaign-cities">
                <span>ğŸ“</span> {{ getCitiesString(campaign.cities) }}
              </p>
            </div>
            <div class="campaign-status">
              <span class="status-badge" [class]="'status-' + campaign.status.toLowerCase()">
                <span class="status-dot"></span>
                {{ campaign.status }}
              </span>
            </div>
          </div>

          <!-- Card Body -->
          <div class="campaign-card-body">
            <div class="info-row">
              <div class="info-item">
                <span class="info-icon">ğŸ“†</span>
                <div class="info-content">
                  <span class="info-label">Campaign Period</span>
                  <span class="info-value">{{ formatDate(campaign.startDate) }} - {{ formatDate(campaign.endDate) }}</span>
                </div>
              </div>
              <div class="info-item">
                <span class="info-icon">â±ï¸</span>
                <div class="info-content">
                  <span class="info-label">Duration</span>
                  <span class="info-value">{{ getDaysDiff(campaign.startDate, campaign.endDate) }} days</span>
                </div>
              </div>
            </div>

            <div class="info-row">
              <div class="info-item">
                <span class="info-icon">ğŸ’°</span>
                <div class="info-content">
                  <span class="info-label">Budget</span>
                  <span class="info-value amount">{{ formatCurrency(campaign.budget) }}</span>
                </div>
              </div>
              <div class="info-item">
                <span class="info-icon">ğŸ’¸</span>
                <div class="info-content">
                  <span class="info-label">Spent</span>
                  <span class="info-value">{{ formatCurrency(campaign.spent) }}</span>
                </div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="budget-progress">
              <div class="progress-header">
                <span>Budget Utilization</span>
                <span class="progress-percent">{{ getProgress(campaign.spent, campaign.budget) }}%</span>
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill"
                  [class.warning]="getProgress(campaign.spent, campaign.budget) >= 80"
                  [class.danger]="getProgress(campaign.spent, campaign.budget) >= 100"
                  [style.width.%]="getProgress(campaign.spent, campaign.budget)">
                </div>
              </div>
            </div>
          </div>

          <!-- Card Actions - Grid Layout -->
          <div class="campaign-card-actions">
            <button class="action-btn attach-btn" (click)="openAttachModal(campaign)" [disabled]="processing()">
              <span>ğŸ”—</span> Attach
            </button>

            @if (canPause(campaign)) {
              <button class="action-btn pause-btn" (click)="pauseCampaign(campaign)" [disabled]="processing()">
                <span>â¸ï¸</span> Pause
              </button>
            }

            @if (canResume(campaign)) {
              <button class="action-btn resume-btn" (click)="resumeCampaign(campaign)" [disabled]="processing()">
                <span>â–¶ï¸</span> Resume
              </button>
            }

            <button class="action-btn analytics-btn" (click)="navigateToAnalytics(campaign)">
              <span>ğŸ“Š</span> Analytics
            </button>

            <button class="action-btn delete-btn" (click)="openDeleteModal(campaign)" [disabled]="processing()">
              <span>ğŸ—‘ï¸</span> Delete
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>

<!-- Attach Booking Modal -->
@if (showAttachModal() && selectedCampaign()) {
  <div class="modal-overlay" (click)="closeAttachModal()">
    <div class="modal-container animate-scale-in" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon">
          <span>ğŸ”—</span>
        </div>
        <h2>Attach Booking</h2>
        <button class="modal-close" (click)="closeAttachModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <div class="campaign-preview">
          <p><strong>Campaign:</strong> {{ selectedCampaign()!.name }}</p>
        </div>

        @if (loadingBookings()) {
          <div class="loading-spinner-small">
            <div class="spinner"></div>
            <p>Loading available bookings...</p>
          </div>
        } @else if (availableBookings().length === 0) {
          <div class="empty-bookings">
            <span>ğŸ“­</span>
            <p>No available bookings found.</p>
            <span class="hint">Only approved and paid bookings can be attached.</span>
          </div>
        } @else {
          <div class="bookings-select-list">
            <p class="select-label">Select a booking to attach:</p>
            @for (booking of availableBookings(); track booking.id) {
              <div
                class="booking-select-item"
                [class.selected]="selectedBookingId === booking.id"
                (click)="selectBooking(booking.id)">
                <div class="booking-select-check">
                  @if (selectedBookingId === booking.id) {
                    <span>âœ“</span>
                  }
                </div>
                <div class="booking-select-info">
                  <h4>{{ booking.billboardTitle }}</h4>
                  <p>ğŸ“ {{ booking.billboardLocation }}</p>
                  <p>ğŸ“… {{ formatDate(booking.startDate) }} - {{ formatDate(booking.endDate) }}</p>
                </div>
                <div class="booking-select-amount">
                  {{ formatCurrency(booking.totalAmount) }}
                </div>
              </div>
            }
          </div>
        }
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closeAttachModal()" [disabled]="processing()">
          Cancel
        </button>
        <button
          class="btn btn-primary"
          (click)="attachBooking()"
          [disabled]="!selectedBookingId || processing()">
          @if (processing()) {
            <span class="btn-spinner"></span> Attaching...
          } @else {
            <span>ğŸ”—</span> Attach Booking
          }
        </button>
      </div>
    </div>
  </div>
}

<!-- Delete Confirmation Modal -->
@if (showDeleteModal() && campaignToDelete()) {
  <div class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal-container delete-modal animate-scale-in" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon warning-icon">
          <span>âš ï¸</span>
        </div>
        <h2>Delete Campaign</h2>
        <button class="modal-close" (click)="closeDeleteModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete this campaign?</p>

        <div class="campaign-preview danger">
          <h4>{{ campaignToDelete()!.name }}</h4>
          <p>ğŸ“ {{ getCitiesString(campaignToDelete()!.cities) }}</p>
          <p>ğŸ’° Budget: {{ formatCurrency(campaignToDelete()!.budget) }}</p>
        </div>

        <div class="delete-warning">
          <span class="warning-icon">â›”</span>
          <p>This action cannot be undone. All campaign data will be permanently deleted.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closeDeleteModal()" [disabled]="processing()">
          Cancel
        </button>
        <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="processing()">
          @if (processing()) {
            <span class="btn-spinner"></span> Deleting...
          } @else {
            <span>ğŸ—‘ï¸</span> Delete Campaign
          }
        </button>
      </div>
    </div>
  </div>
}
