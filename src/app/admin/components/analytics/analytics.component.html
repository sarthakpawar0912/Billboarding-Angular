<div class="analytics-page">
  <div class="page-header">
    <div class="header-content">
      <h1>Analytics</h1>
      <p>Platform performance metrics and insights</p>
    </div>
    <div class="header-actions">
      <select class="period-select">
        <option>Last 30 Days</option>
        <option>Last 7 Days</option>
        <option>Last 3 Months</option>
        <option>Last Year</option>
      </select>
      <button class="btn btn-primary" (click)="loadAnalytics()">
        <span>üîÑ</span> Refresh
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading analytics...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error() }}</p>
      <button class="btn btn-primary" (click)="loadAnalytics()">Try Again</button>
    </div>
  }

  @if (!loading() && !error()) {
  <!-- Performance Cards -->
  <div class="performance-grid">
    @for (item of performanceData(); track item.label) {
      <div class="performance-card">
        <span class="perf-label">{{ item.label }}</span>
        <span class="perf-value">{{ item.value }}</span>
        <span class="perf-change" [class.positive]="item.isPositive" [class.negative]="!item.isPositive">
          {{ item.change }}
        </span>
      </div>
    }
  </div>

  <!-- Financial Summary -->
  <div class="financial-summary">
    <div class="financial-card">
      <div class="financial-icon revenue">üí∞</div>
      <div class="financial-content">
        <div class="financial-label">Total Revenue</div>
        <div class="financial-value">{{ formatCurrency(platformFinancials().totalRevenue) }}</div>
        <div class="financial-subtext">From all bookings</div>
      </div>
    </div>
    <div class="financial-card">
      <div class="financial-icon commission">üìä</div>
      <div class="financial-content">
        <div class="financial-label">Platform Commission</div>
        <div class="financial-value">{{ formatCurrency(platformFinancials().totalCommission) }}</div>
        <div class="financial-subtext">Your earnings</div>
      </div>
    </div>
    <div class="financial-card">
      <div class="financial-icon gst">üßæ</div>
      <div class="financial-content">
        <div class="financial-label">Total GST Collected</div>
        <div class="financial-value">{{ formatCurrency(platformFinancials().totalGst) }}</div>
        <div class="financial-subtext">Tax liability</div>
      </div>
    </div>
  </div>

  <div class="content-grid">
    <!-- Revenue Chart -->
    <div class="card chart-card">
      <div class="card-header">
        <h3>Revenue Trend</h3>
        <div class="chart-legend">
          <span class="legend-item"><span class="dot blue"></span> Revenue</span>
          <span class="legend-item"><span class="dot green"></span> Bookings</span>
        </div>
      </div>
      <div class="chart-area">
        <div class="bar-chart">
          @for (data of analytics().monthlyRevenue; track data.month) {
            <div class="bar-column">
              <div class="bar" [style.height.%]="getBarHeight(data.revenue)"></div>
              <span class="bar-label">{{ data.month }}</span>
            </div>
          } @empty {
            <div class="empty-chart">No revenue data available</div>
          }
        </div>
      </div>
    </div>

    <!-- Top Cities -->
    <div class="card">
      <div class="card-header">
        <h3>Top Performing Cities</h3>
      </div>
      <div class="cities-list">
        @for (city of analytics().topCities; track city.city; let i = $index) {
          <div class="city-row">
            <span class="city-rank">{{ i + 1 }}</span>
            <span class="city-name">{{ city.city }}</span>
            <div class="city-progress">
              <div class="progress-bar" [style.width.%]="getCityProgress(city.count)"></div>
            </div>
            <span class="city-value">{{ city.count }}</span>
          </div>
        } @empty {
          <div class="empty-list">No city data available</div>
        }
      </div>
    </div>

    <!-- Billboard Types Distribution -->
    <div class="card">
      <div class="card-header">
        <h3>Billboard Types Distribution</h3>
      </div>
      <div class="types-chart">
        @for (item of analytics().demandByType; track item.type) {
          <div class="type-item">
            <div class="type-info">
              <span class="type-name">{{ item.type }}</span>
              <span class="type-percent">{{ item.demand }}%</span>
            </div>
            <div class="type-bar-container">
              <div class="type-bar"
                   [class]="'type-' + item.type.toLowerCase()"
                   [style.width.%]="item.demand"></div>
            </div>
          </div>
        } @empty {
          <div class="empty-list">No billboard type data available</div>
        }
      </div>
    </div>

    <!-- Top Advertisers -->
    <div class="card">
      <div class="card-header">
        <h3>Top Advertisers</h3>
      </div>
      <div class="advertisers-list">
        @for (advertiser of topAdvertisers(); track advertiser.name; let i = $index) {
          <div class="advertiser-row">
            <span class="advertiser-rank">{{ i + 1 }}</span>
            <div class="advertiser-info">
              <span class="advertiser-name">{{ advertiser.name }}</span>
              <span class="advertiser-bookings">{{ advertiser.bookings }} bookings</span>
            </div>
            <span class="advertiser-spent">{{ formatCurrency(advertiser.spent) }}</span>
          </div>
        } @empty {
          <div class="empty-list">No advertiser data available</div>
        }
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="quick-stats">
    <div class="quick-stat-card">
      <div class="stat-icon">üìà</div>
      <div class="stat-content">
        <span class="stat-value">{{ analytics().totalBillboards }}</span>
        <span class="stat-label">Active Billboards</span>
      </div>
    </div>
    <div class="quick-stat-card">
      <div class="stat-icon">üë•</div>
      <div class="stat-content">
        <span class="stat-value">{{ analytics().totalOwners }}</span>
        <span class="stat-label">Verified Owners</span>
      </div>
    </div>
    <div class="quick-stat-card">
      <div class="stat-icon">üéØ</div>
      <div class="stat-content">
        <span class="stat-value">{{ analytics().totalAdvertisers }}</span>
        <span class="stat-label">Active Advertisers</span>
      </div>
    </div>
    <div class="quick-stat-card">
      <div class="stat-icon">‚ö°</div>
      <div class="stat-content">
        <span class="stat-value">{{ analytics().activeBookings }}</span>
        <span class="stat-label">Live Campaigns</span>
      </div>
    </div>
  </div>
  } <!-- end of !loading && !error -->
</div>
